<?php

use App\Http\Controllers\Admin\ActivityLogController as AdminActivityLogController;
use App\Http\Controllers\Admin\DashboardController as AdminDashboardController;
use App\Http\Controllers\Admin\UserController as AdminUserController;
use App\Http\Controllers\BirthdayController;
use App\Http\Controllers\DashboardController;
use App\Http\Controllers\HealthController;
use App\Http\Controllers\HomeController;
use App\Http\Controllers\HelpController;
use App\Http\Controllers\ProfileController;
use App\Http\Controllers\RoleGuideController;
use App\Http\Controllers\Treasurer\ContributionController;
use App\Http\Controllers\Treasurer\DonationController;
use App\Http\Controllers\Treasurer\DuesController;
use App\Http\Controllers\Treasurer\ExpenseController;
use App\Http\Controllers\Treasurer\IncomeController;
use App\Http\Controllers\Treasurer\LoanController;
use App\Http\Controllers\Treasurer\LoanRepaymentController;
use App\Http\Controllers\Treasurer\MemberController;
use App\Http\Controllers\Treasurer\ReceiptController;
use App\Http\Controllers\Treasurer\ReportController;
use App\Http\Controllers\Treasurer\SpecialContributionController;
use App\Http\Controllers\Transparency\TransparencyController;
use Illuminate\Support\Facades\Route;

Route::get('/', HomeController::class);
Route::get('/health', HealthController::class);

Route::get('/transparency', [TransparencyController::class, 'index'])->name('transparency');

Route::get('/dashboard', [DashboardController::class, 'index'])
    ->middleware(['auth', 'active', 'role:admin,treasurer,viewer'])
    ->name('dashboard');

Route::get('/role-guide', [RoleGuideController::class, 'index'])
    ->middleware(['auth', 'active'])
    ->name('role-guide');

Route::get('/role-guide/admin', [RoleGuideController::class, 'admin'])
    ->middleware(['auth', 'active', 'role:admin'])
    ->name('role-guide.admin');

Route::get('/role-guide/treasurer', [RoleGuideController::class, 'treasurer'])
    ->middleware(['auth', 'active', 'role:admin,treasurer'])
    ->name('role-guide.treasurer');

Route::get('/role-guide/viewer', [RoleGuideController::class, 'viewer'])
    ->middleware(['auth', 'active', 'role:viewer'])
    ->name('role-guide.viewer');

Route::middleware(['auth', 'active'])->group(function () {
    Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');
    Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');
    Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');
});

Route::middleware(['auth', 'active', 'role:admin,treasurer,viewer'])->group(function () {
    Route::get('members', [MemberController::class, 'index'])->name('members.index');
    Route::get('reports', [ReportController::class, 'index'])->name('reports.index');
    Route::get('reports/ccm-summary.csv', [ReportController::class, 'ccmSummaryCsv'])->name('reports.ccm-summary.csv');
    Route::get('reports/ccm-summary.pdf', [ReportController::class, 'ccmSummaryPdf'])->name('reports.ccm-summary.pdf');
    Route::get('birthdays', [BirthdayController::class, 'index'])->name('birthdays.index');
    Route::get('help', [HelpController::class, 'index'])->name('help.index');
    Route::get('help/pdf', [HelpController::class, 'pdf'])->name('help.pdf');
});

Route::middleware(['auth', 'active', 'role:admin,treasurer'])->group(function () {
    Route::resource('members', MemberController::class)->except(['index']);
    Route::get('dues', [DuesController::class, 'index'])->name('dues.index');
    Route::post('dues', [DuesController::class, 'store'])->name('dues.store');
    Route::resource('contributions', ContributionController::class)->only(['index', 'create', 'store', 'show', 'destroy']);
    Route::resource('special-contributions', SpecialContributionController::class)->only(['index', 'store']);
    Route::resource('donations', DonationController::class)->only(['index', 'store']);
    Route::resource('incomes', IncomeController::class)->only(['index', 'create', 'store', 'show', 'destroy']);
    Route::resource('expenses', ExpenseController::class)->only(['index', 'create', 'store', 'show', 'destroy']);
    Route::resource('loans', LoanController::class)->only(['index', 'create', 'store', 'show']);
    Route::post('loan-repayments', [LoanRepaymentController::class, 'store'])->name('loan-repayments.store');
    Route::resource('receipts', ReceiptController::class)->only(['index', 'show']);
    Route::get('receipts/{receipt}/download', [ReceiptController::class, 'download'])->name('receipts.download');
    Route::get('receipts/{receipt}/view', [ReceiptController::class, 'view'])->name('receipts.view');
    Route::get('reports/financial', [ReportController::class, 'financial'])->name('reports.financial');
    Route::get('reports/financial/print', [ReportController::class, 'financialPrint'])->name('reports.financial.print');
    Route::get('reports/financial/pdf', [ReportController::class, 'financialPdf'])->name('reports.financial.pdf');
});

Route::prefix('admin')->name('admin.')->middleware(['auth', 'active', 'role:admin'])->group(function () {
    Route::get('/', [AdminDashboardController::class, 'index'])->name('dashboard');
    Route::get('/users', [AdminUserController::class, 'index'])->name('users.index');
    Route::get('/users/{user}/edit', [AdminUserController::class, 'edit'])->name('users.edit');
    Route::put('/users/{user}', [AdminUserController::class, 'update'])->name('users.update');
    Route::patch('/users/{user}/toggle-status', [AdminUserController::class, 'toggleStatus'])->name('users.toggle-status');
    Route::get('/activity-logs', [AdminActivityLogController::class, 'index'])->name('activity-logs.index');
    Route::delete('/activity-logs', [AdminActivityLogController::class, 'clear'])->name('activity-logs.clear');
});

require __DIR__.'/auth.php';
